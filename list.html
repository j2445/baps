<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yuvak Mandal Attendance</title>
  <link rel="stylesheet" href="styles.css" />
  <script>
    if (sessionStorage.getItem("loggedIn") !== "true") {
      window.location.href = "login.html";
    }
  </script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      padding: 10px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 10px;
    }
    .name-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .name-button {
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #f1f1f1;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      transition: 0.3s ease;
      font-size: 0.95em;
    }
    .name-button:hover:not(.done):not(.selected) {
      background-color: #dcdcdc;
    }
    .name-button.selected {
      background-color: #3498db;
      color: white;
      border-color: #2980b9;
    }
    .name-button.done {
      background-color: #2ecc71;
      color: white;
      cursor: not-allowed;
    }
    #markPresentButton {
      margin-top: 15px;
      background-color: #2ecc71;
      width: 100%;
      font-weight: bold;
      font-size: 1.1em;
      padding: 12px;
      border: none;
      color: white;
      border-radius: 6px;
    }
    #markPresentButton:hover {
      background-color: #27ae60;
    }
    .bottom-controls, .action-buttons {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .bottom-controls input, #searchInput {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 150px;
    }
    .bottom-controls button, .action-buttons button, .action-buttons a {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #3498db;
      color: white;
      text-decoration: none;
      transition: 0.3s ease;
    }
    .bottom-controls button:hover, .action-buttons button:hover, .action-buttons a:hover {
      background-color: #2980b9;
    }
    .logout-button {
      background-color: #e74c3c;
    }
    .logout-button:hover {
      background-color: #c0392b;
    }
    .search-container {
      margin-top: 15px;
      text-align: center;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      .name-button {
        font-size: 0.85em;
        padding: 10px;
      }
    }

    /* Modal Styles */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fefefe;
      margin: auto; /* Center the modal */
      padding: 20px;
      border: 1px solid #888;
      width: 80%; /* Could be more or less, depending on screen size */
      max-width: 400px;
      border-radius: 8px;
      text-align: center;
      position: relative;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 10px;
      right: 15px;
    }

    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="image.png" alt="Logo" class="website-logo" style="max-width: 300px; display: block; margin: auto;" />
    <h1 style="text-align:center">Yuvak Mandal Attendance</h1>

    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Search Yuvak..." oninput="renderNames()" />
    </div>

    <div class="form-group">
      <div class="name-grid" id="nameGrid"></div>
    </div>

    <div class="action-buttons">
      <a href="records.html">View Records</a>
      <button id="logoutButton" class="logout-button">Logout</button>
    </div>
  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <p id="modalMessage"></p>
    </div>
  </div>

  <script>
    const defaultNames = [
      "Vidur M. Patel", "Meet G. Patel", "Tilak V. Patel", "Priyash H. Patel", "Krish P. Patel",
      "Kirtan D. Parmar", "Bhaumik Patel", "Parth A. Patel", "Maan A. Patel", "Dhaval Parmar",
      "Jaydeep K. Gohel", "Kishan P. Patel", "Dheeren J. Patel", "Nil H. Bhoi", "Dhruvil K. Patel",
      "Meet S. Patel (Road)", "Preet S. Patel", "Jagrut J. Patel", "Manan D. Ka.Patel", "Joy P. Patel",
      "Hari P. Ka.Patel", "Tanmay D. Ka.Patel", "Jay R. Patel", "Dhirendrabhai Patel", "Mayankbhai Patel",
      "Jay Ka.Patel", "Archik Solanki", "Mousam Ka.Patel", "Vivek Ka.Patel", "Mihirbhai Patel",
      "Harsh K. Patel", "Lalitbhai A. Gohel", "Gautambhai A. Gohel", "Manish Prajapati", "Tushar Rohit",
      "Harsh H. Patel", "Paath H. Patel", "Akshay P. Patel", "Pratik J. Patel", "Akshar C. Patel",
      "Harshil V. Patel", "Tejash P. Patel", "Zeel D. Patel", "Yug P. Patel", "Parth Chavda",
      "Harsh R. Ka.Patel", "Savan M. Patel", "Bhavy R. Patel", "Mantra A. Patel", "Nishant S. Arya",
      "Meet S. Patel", "Dhaval K. Ka.Patel", "Darshan D. Patel", "Hitesh N. Patel", "Subhash A. Patel","Bharat Y. Patel"
    ];

    let names = JSON.parse(localStorage.getItem('yuvakNames')) || defaultNames;

    let selectedIndex = -1;
    let selectedName = '';
    let records = JSON.parse(localStorage.getItem("attendanceRecords")) || [];
    const today = formatDate(new Date());

    if (localStorage.getItem('lastAttendanceDate') !== today) {
      records = [];
      localStorage.removeItem("attendanceRecords");
    }
    localStorage.setItem("lastAttendanceDate", today);

    function formatDate(date) {
      return date.toLocaleDateString('en-GB');
    }
    function formatTime(date) {
      return date.toLocaleTimeString('en-US');
    }

    function saveNames() {
      localStorage.setItem('yuvakNames', JSON.stringify(names));
    }


    function renderNames() {
      const grid = document.getElementById("nameGrid");
      const search = document.getElementById("searchInput").value.toLowerCase();
      grid.innerHTML = "";
      names.forEach((name, index) => {
        if (name.toLowerCase().includes(search)) {
          const btn = document.createElement("button");
          btn.className = "name-button";
          btn.textContent = `${index + 1}. ${name}`;
          btn.dataset.name = name;
          if (records.some(r => r.name === name && r.date === today)) {
            btn.classList.add("done");
            btn.disabled = true;
          }
          if (index === selectedIndex) {
            btn.classList.add("selected");
          }
          btn.onclick = () => {
            if (!btn.classList.contains("done")) {
              selectedIndex = index;
              selectedName = name;
              renderNames();
            }
          };
          btn.ondblclick = () => {
            if (!btn.classList.contains("done")) {
              markNamePresent(name);
            }
          };
          grid.appendChild(btn);
        }
      });
    }

    function markNamePresent(nameToMark) {
      const now = new Date();
      const attendanceEntry = {
        name: nameToMark,
        date: today,
        time: formatTime(now),
      };

      if (!records.some(r => r.name === nameToMark && r.date === today)) {
        records.push(attendanceEntry);
        localStorage.setItem("attendanceRecords", JSON.stringify(records));
        renderNames(); // Re-render to update the button state
        showModal(`${nameToMark} marked present!`);
      } else {
        showModal(`${nameToMark} is already marked present for today.`);
      }
    }

    function markPresent() {
      if (selectedName) {
        markNamePresent(selectedName);
      } else {
        showModal("Please select a Yuvak first.");
      }
    }

    // Removed: document.getElementById("markPresentButton").addEventListener("click", () => {
    // Removed:   if (!selectedName) return showModal("Please select a Yuvak.");
    // Removed:   const now = new Date();
    // Removed:   records.push({ name: selectedName, date: formatDate(now), time: formatTime(now) });
    // Removed:   localStorage.setItem("attendanceRecords", JSON.stringify(records));
    // Removed:   selectedIndex = -1;
    // Removed:   selectedName = '';
    // Removed:   renderNames();
    // Removed: });

    function addName() {
      const input = document.getElementById("newNameInput");
      const name = input.value.trim();
      if (!name) return showModal("Enter a name.");
      names.push(name);
      input.value = "";
      renderNames();
    }
    function editSelectedName() {
      const input = document.getElementById("newNameInput");
      const name = input.value.trim();
      if (selectedIndex === -1 || !name) return showModal("Select and enter a new name.");
      names[selectedIndex] = name;
      selectedIndex = -1;
      selectedName = '';
      input.value = "";
      renderNames();
    }
    function removeSelectedName() {
      if (selectedIndex === -1) return showModal("Select a name to remove.");
      if (confirm(`Remove "${names[selectedIndex]}"?`)) {
        names.splice(selectedIndex, 1);
        selectedIndex = -1;
        selectedName = '';
        renderNames();
      }
    }
    document.getElementById("logoutButton").addEventListener("click", () => {
      sessionStorage.removeItem("loggedIn");
      window.location.href = "index.html";
    });

    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close-button")[0];

    // Function to display the modal
    function showModal(message) {
      document.getElementById("modalMessage").textContent = message;
      modal.style.display = "flex"; // Use flex to center content
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    renderNames();
  </script>
</body>
</html>
