<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yuvak Mandal Attendance</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/en/4/4a/Baps_logo.svg" type="image/svg+xml">
  <script>
    if (sessionStorage.getItem("loggedIn") !== "true") {
      window.location.href = "login.html";
    }
  </script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      padding: 10px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 10px;
    }
    .name-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .name-button {
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #f1f1f1;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      transition: 0.3s ease;
      font-size: 0.95em;
      position: relative;
    }
    .name-button:hover:not(.done):not(.selected) {
      background-color: #dcdcdc;
    }
    .name-button.selected {
      background-color: #3498db;
      color: white;
      border-color: #2980b9;
    }
    .name-button.done {
      background-color: #2ecc71;
      color: white;
      cursor: not-allowed;
    }
    .name-button.aarti {
      background-color: #f39c12;
      color: white;
    }
    .name-button.both {
      background: linear-gradient(135deg, #2ecc71 50%, #f39c12 50%);
      color: white;
    }
    .attendance-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .attendance-buttons button {
      flex: 1;
      font-weight: bold;
      font-size: 1.1em;
      padding: 12px;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    #markPresentButton {
      background-color: #2ecc71;
    }
    #markPresentButton:hover {
      background-color: #27ae60;
    }
    #markAartiButton {
      background-color: #f39c12;
    }
    #markAartiButton:hover {
      background-color: #e67e22;
    }
    .bottom-controls, .action-buttons {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .bottom-controls input, #searchInput {
      flex: 1;
      padding: 10px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 150px;
    }
    .bottom-controls button, .action-buttons button, .action-buttons a {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #3498db;
      color: white;
      text-decoration: none;
      transition: 0.3s ease;
    }
    .bottom-controls button:hover, .action-buttons button:hover, .action-buttons a:hover {
      background-color: #2980b9;
    }
    .logout-button {
      background-color: #e74c3c;
    }
    .logout-button:hover {
      background-color: #c0392b;
    }
    .search-container {
      margin-top: 15px;
      text-align: center;
    }
    .tabs {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #ccc;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: 1px solid #ccc;
      border-bottom: none;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
    }
    .tab.active {
      background-color: #3498db;
      color: white;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      .name-button {
        font-size: 0.85em;
        padding: 10px;
      }
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
      border-radius: 8px;
      text-align: center;
      position: relative;
    }

    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 10px;
      right: 15px;
    }

    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="image.png" alt="Logo" class="website-logo" style="max-width: 300px; display: block; margin: auto;" />
    <h1 style="text-align:center">Yuvak Mandal Attendance</h1>

    <div class="tabs">
      <div class="tab active" onclick="showTab('sabha')">Sabha Attendance</div>
      <div class="tab" onclick="showTab('aarti')">Aarti Attendance</div>
    </div>

    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Search Yuvak..." oninput="renderNames()" />
    </div>

    <div class="form-group">
      <div class="name-grid" id="nameGrid"></div>
    </div>

    <div class="attendance-buttons">
      <button id="markPresentButton" onclick="markPresent()">Mark Sabha Present</button>
      <button id="markAartiButton" onclick="markAarti()">Mark Aarti Present</button>
    </div>

    <div class="action-buttons">
      <a href="records.html">View Records</a>
      <button id="logoutButton" class="logout-button">Logout</button>
    </div>
  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <p id="modalMessage"></p>
    </div>
  </div>

  <script>
    const defaultNames = [
      "Vidur M. Patel", "Meet G. Patel", "Tilak V. Patel", "Priyash H. Patel", "Krish P. Patel",
      "Kirtan D. Parmar", "Bhaumik Patel", "Parth A. Patel", "Maan A. Patel", "Dhaval Parmar",
      "Jaydeep K. Gohel", "Kishan P. Patel", "Dheeren J. Patel", "Nil H. Bhoi", "Dhruvil K. Patel",
      "Meet S. Patel (Road)", "Preet S. Patel", "Jagrut J. Patel", "Manan D. Ka.Patel", "Joy P. Patel",
      "Hari P. Ka.Patel", "Tanmay D. Ka.Patel", "Jay R. Patel", "Dhirendrabhai Patel", "Mayankbhai Patel",
      "Jay Ka.Patel", "Archik Solanki", "Mousam Ka.Patel", "Vivek Ka.Patel", "Mihirbhai Patel",
      "Harsh K. Patel", "Lalitbhai A. Gohel", "Gautambhai A. Gohel", "Manish Prajapati", "Tushar Rohit",
      "Harsh H. Patel", "Paath H. Patel", "Akshay P. Patel", "Pratik J. Patel", "Akshar C. Patel",
      "Harshil V. Patel", "Tejash P. Patel", "Zeel D. Patel", "Yug P. Patel", "Parth Chavda",
      "Harsh R. Ka.Patel", "Savan M. Patel", "Bhavy R. Patel", "Mantra A. Patel", "Nishant S. Arya",
      "Meet S. Patel", "Dhaval K. Ka.Patel", "Darshan D. Patel", "Hiteshbhai N. Patel", "Subhashbhai A. Patel","Bharatbhai Y. Patel"
    ];

    let names = JSON.parse(localStorage.getItem('yuvakNames')) || defaultNames;
    let selectedIndex = -1;
    let selectedName = '';
    let currentTab = 'sabha';
    
    // Load attendance records
    let sabhaRecords = JSON.parse(localStorage.getItem("sabhaAttendanceRecords")) || [];
    let aartiRecords = JSON.parse(localStorage.getItem("aartiAttendanceRecords")) || [];
    
    const today = formatDate(new Date());

    // Reset records if it's a new day
    if (localStorage.getItem('lastAttendanceDate') !== today) {
      sabhaRecords = [];
      aartiRecords = [];
      localStorage.removeItem("sabhaAttendanceRecords");
      localStorage.removeItem("aartiAttendanceRecords");
    }
    localStorage.setItem("lastAttendanceDate", today);

    function formatDate(date) {
      return date.toLocaleDateString('en-GB');
    }
    
    function formatTime(date) {
      return date.toLocaleTimeString('en-US');
    }

    function saveNames() {
      localStorage.setItem('yuvakNames', JSON.stringify(names));
    }

    function showTab(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', tab.textContent.toLowerCase().includes(tabName));
      });
      renderNames();
    }

    function renderNames() {
      const grid = document.getElementById("nameGrid");
      const search = document.getElementById("searchInput").value.toLowerCase();
      grid.innerHTML = "";
      
      names.forEach((name, index) => {
        if (name.toLowerCase().includes(search)) {
          const btn = document.createElement("button");
          btn.className = "name-button";
          btn.textContent = `${index + 1}. ${name}`;
          btn.dataset.name = name;
          
          // Check attendance status
          const isSabhaPresent = sabhaRecords.some(r => r.name === name && r.date === today);
          const isAartiPresent = aartiRecords.some(r => r.name === name && r.date === today);
          
          if (isSabhaPresent && isAartiPresent) {
            btn.classList.add("both");
          } else if (isSabhaPresent) {
            btn.classList.add("done");
          } else if (isAartiPresent) {
            btn.classList.add("aarti");
          }
          
          if (index === selectedIndex) {
            btn.classList.add("selected");
          }
          
          btn.onclick = () => {
            if (!(isSabhaPresent && isAartiPresent)) {
              selectedIndex = index;
              selectedName = name;
              renderNames();
            }
          };
          
          btn.ondblclick = () => {
            if (!(isSabhaPresent && isAartiPresent)) {
              if (currentTab === 'sabha') {
                markNamePresent(name, 'sabha');
              } else {
                markNamePresent(name, 'aarti');
              }
            }
          };
          
          grid.appendChild(btn);
        }
      });
    }

    function markNamePresent(nameToMark, type) {
      const now = new Date();
      const attendanceEntry = {
        name: nameToMark,
        date: today,
        time: formatTime(now),
        type: type
      };

      if (type === 'sabha') {
        if (!sabhaRecords.some(r => r.name === nameToMark && r.date === today)) {
          sabhaRecords.push(attendanceEntry);
          localStorage.setItem("sabhaAttendanceRecords", JSON.stringify(sabhaRecords));
          showModal(`${nameToMark} marked present for sabha!`);
        } else {
          showModal(`${nameToMark} is already marked present for sabha today.`);
        }
      } else if (type === 'aarti') {
        if (!aartiRecords.some(r => r.name === nameToMark && r.date === today)) {
          aartiRecords.push(attendanceEntry);
          localStorage.setItem("aartiAttendanceRecords", JSON.stringify(aartiRecords));
          showModal(`${nameToMark} marked present for aarti!`);
        } else {
          showModal(`${nameToMark} is already marked present for aarti today.`);
        }
      }
      
      renderNames();
    }

    function markPresent() {
      if (selectedName) {
        markNamePresent(selectedName, 'sabha');
      } else {
        showModal("Please select a Yuvak first.");
      }
    }

    function markAarti() {
      if (selectedName) {
        markNamePresent(selectedName, 'aarti');
      } else {
        showModal("Please select a Yuvak first.");
      }
    }

    document.getElementById("logoutButton").addEventListener("click", () => {
      sessionStorage.removeItem("loggedIn");
      window.location.href = "index.html";
    });

    // Modal functionality
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close-button")[0];

    function showModal(message) {
      document.getElementById("modalMessage").textContent = message;
      modal.style.display = "flex";
    }

    span.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    renderNames();
  </script>
</body>
</html>
